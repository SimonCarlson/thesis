\documentclass{kththesis}

\usepackage{csquotes} % Recommended by biblatex
\usepackage[backend=biber, sorting=none, citestyle=ieee]{biblatex}
\usepackage{subfiles} % To segment the thesis
\usepackage{longtable} % For tables generated by pandoc from markdown
\usepackage{booktabs} % For rules in tables 
\usepackage{bytefield} % For protocol headers
\usepackage{listings} % For code snippets 
\usepackage{tikz} % For drawing figures
\usetikzlibrary{arrows, automata, positioning, decorations.text}
\usepackage{pgf} % For PDF graphics
\usepackage[acronym,nonumberlist,nomain,nopostdot]{glossaries} % For the glossary
\usepackage{enumitem} % For changing enumerations
\usepackage{microtype} % Long words and line breaking
\usepackage{hyperref} % For links in table of contents
\usepackage{color} % For coloring links

\makeglossaries
\newacronym{iot}{IoT}{Internet of Things}
\newacronym{suit}{SUIT}{Software Updates for Internet of Things}
\newacronym{ietf}{IETF}{Internet Engineering Task Force}
\newacronym{ip}{IP}{Internet Protocol}
\newacronym{tcp}{TCP}{Transmission Control Protocol}
\newacronym{udp}{UDP}{User Datagram Protocol}
\newacronym{tls}{TLS}{Transport Layer Security}
\newacronym{dtls}{DTLS}{Datagram Transport Layer Security}
\newacronym{http}{HTTP}{Hypertext Transfer Protocol}
\newacronym{coap}{CoAP}{Constrained Application Protocol}
\newacronym{est}{EST}{Enrollment over Secure Transport}
\newacronym{pki}{PKI}{Public Key Infrastructure}
\newacronym{uri}{URI}{Uniform Resource Identifier}
\newacronym{sha}{SHA}{Secure Hash Algorithm}
\newacronym{mcu}{MCU}{Microcontroller Unit}
\newacronym{json}{JSON}{JavaScript Object Notation}
\newacronym{cbor}{CBOR}{Concise Binary Object Representation}
\newacronym{ace}{ACE}{Authentication and Authorization for Constrained Environments}
\newacronym{ca}{CA}{Certificate Authority}
\newacronym{cose}{COSE}{CBOR Object Signing and Encryption}
\newacronym{oscore}{OSCORE}{Object Security for Constrained RESTful Environments}

\addbibresource{references.bib} % The file containing our references, in BibTeX format

\definecolor{background}{HTML}{EEEEEE}

\lstdefinelanguage{blockc}{
    language=C,
    basicstyle=\ttfamily,
    numbers=left,
    numberstyle=\scriptsize,
    stepnumber=1,
    numbersep=8pt,
    %showstringspaces=false,
    breaklines=true
    %frame=lines,
    %backgroundcolor=\color{background},
}

\lstdefinelanguage{blockjson}{
    basicstyle=\ttfamily,
    numbers=left,
    numberstyle=\scriptsize,
    stepnumber=1,
    numbersep=8pt
}

\lstdefinelanguage{manifest} {
    alsoletter={\alphabet},
    aboveskip=20pt,
    belowskip=20pt,
    %backgroundcolor=\color{seashell},
    basicstyle=\footnotesize\ttfamily,
    captionpos=b,
    breaklines=true,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
    numbers=left,
    stepnumber=1,
    literate={92f84}{92f84\allowbreak}{5}
    {fa227}{fa227\allowbreak}{5}
}

\providecommand{\keywords}[1]{\textbf{\textit{Keywords:}} #1}
\providecommand{\nyckelord}[1]{\textbf{\textit{Nyckelord:}} #1}

\hypersetup{
    colorlinks=true,
    linktoc=all,
    allcolors=black
}

% TODO: Remove WIP
\title{An Internet of Things Software and Firmware Update Architecture Based\\on the SUIT specification (WIP)}
\alttitle{En Mjukvaru- och Firmwareuppdateringsarkitektur för Internet of Things Baserad på SUIT-specifikationen (WIP)}
\author{Simon Carlson}
\email{scarlso@kth.se}
\kthsupervisor{Farhad Abtahi}
\risesupervisor{Shahid Raza}
\examiner{Elena Dubrova}
\programme{Master in Information Technology}
\school{School of Computer Science and Communication}
\date{\today}


\begin{document}
% TODO: Consider tempus of sections
% Frontmatter includes the titlepage, abstracts and table-of-contents
\frontmatter

\titlepage

\begin{abstract}
\textbf{E}\\


\noindent\keywords{IoT, industrial IoT, security, Contiki, embedded systems, 
                    software updates}
\end{abstract}

\begin{otherlanguage}{swedish}
    \begin{abstract}
        Svensk sammanfattning här.\\

        \noindent\nyckelord{IoT, industriell IoT, säkerhet, Contiki, inbyggda system,
                            mjukvaruuppdateringar}
    \end{abstract}
\end{otherlanguage}


\renewcommand{\abstractname}{Acknowledgements}
\begin{abstract}
    E
\end{abstract}

\tableofcontents
\listoftables
\listoffigures
\lstlistoflistings
\printglossaries

% Mainmatter is where the actual contents of the thesis goes
\mainmatter

% We use the \emph{biblatex} package to handle our references.  We therefore use the
% command \texttt{parencite} to get a reference in parenthesis, like this
% \parencite{heisenberg2015}.  It is also possible to include the author as part of the
% sentence using \texttt{textcite}, like talking about the work of
% \textcite{einstein2016}.

\chapter{Introduction}
\subfile{1-introduction}

\chapter{Background}
\subfile{2-background}

\chapter{Method}
\subfile{3-method}

\chapter{Evaluation}
\subfile{4-evaluation}

\chapter{Discussion}
\subfile{5-discussion}

\printbibliography[heading=bibintoc] % Print the bibliography (and make it appear in the table of contents)

% As of now, placeholder
\appendix

\chapter{Example Manifest}
\label{app:manifest}
The example manifest used during development and evaluation. It was generated by invoking
\texttt{./manifest.py 500-blocks-manifest.json -i 500-blocks-data.txt -v test -c test -u
update/image -m 1}. This command creates an output file named
\texttt{500-blocks-manifest.json} using the data file \texttt{500-blocks-data.txt},
manifest version 1, and namespaces \texttt{test} for both vendor and class id. The data
file contains the server generated data for 500 blocks.

\lstinputlisting[language=manifest, caption={The example manifest \texttt{500-blocks-manifest.json} used in the thesis, pretty-printed.}]{500-blocks-manifest.json}

\chapter{Repositories}
\label{app:repos}
Repository containing client and server update code, located in \texttt{examples/suitup}:
\url{https://github.com/SimonCarlson/contiki-ng/tree/oscore_12}\\

\noindent Repository for manifest generation:
\url{https://github.com/SimonCarlson/manifest-generator}

\chapter{Bare Bones Example Source Code}
\label{app:bare-bones}
\begin{lstlisting}[language=manifest, caption={Bare bones Contiki-NG example.}, label=lst:bare-bones]
    #include "contiki.h"
    #include "contiki-net.h"
    #include "coap-engine.h"
    #include "coap-blocking-api.h"
    #include "coap-keystore-simple.h"

    PROCESS(bare_bones_process, "Bare bones process");
    AUTOSTART_PROCESSES(&bare_bones_process);

    PROCESS_THREAD(bare_bones_process, ev, data) {
    PROCESS_BEGIN();

    PROCESS_END();
    }
\end{lstlisting}


\end{document}
