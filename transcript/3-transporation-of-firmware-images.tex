\documentclass[0-thesis.tex]{subfiles}

\begin{document}
% TODO: Dedicate this to transportation CoAP -> DTLS -> UDP
% TODO: Also format of manifest
% TODO: Encoding? CBOR?

\section{Manifest Format}
\label{sec:manifest-format}
% General intro to the chapter
% Maybe state assumptions about storage and computational capability of target devices?
As the target devices of the update mechanism are contrained IoT devices, the manifest
format must be designed with careful consideration. The format must be easy to parse in
order to reduce power consumption on devices, but must also be small so that
transportation of the manifest is done as quickly as possible. As a rule of thumb, each
byte sent expends as much energy as roughly 8000 CPU cycles, so reducing the size of the
manifest is of importance \parencite{interconnecting}.

Different versions of manifests can feature different fields as amechanism evolves,
therefore the device needs to know what to expect from the manifest. This can be encoded
in a \textbf{manifest version ID}. Rollback attacks need to be prevented so that old,
vulnerable images cannot be applied. They can be mitigated through a \textbf{sequence
number}. Furthermore the \textbf{format} (ELF, binary, etc), the \textbf{size} of the
image, and a \textbf{URI} of where to find the image must be included in three separate
fields. \textbf{Vendor and class IDs}, possibly \textbf{device ID}, must also be included
so that the device knows the image is applicable and will work. Lastly, a \textbf{digest}
of the image must be included so the device can be sure the image has not been tampered
with during transport. These elements are deemed absolutely necessary and form the very
minimum upon which an update mechanism can operate. 

In addition to these elements, there are several elements that are not as critical. If a
device consists of several MCUs, a \textbf{location} element must inform which components
are targeted by the update. This might mean \textbf{several digests} are carried at once,
which needs to be indexed by \textbf{XIP addresses}. If the update is dependant on
previous versions being present, or a differential update needs certain other images to
function, those \textbf{dependencies and precursor images} must be described together with
URIs of where to obtain them. Cryptographic keys can be distributed in different ways, and
a \textbf{key distribution method} element can describe which method is chosen for this
update. These elements have their use cases but as the thesis will primarily look at
updating a singular MCU with one monolithic update using a PKI location, precursors, and
key distribution method are not needed. Also only one digest at a time is needed, but
space will be made to facilitate several digests. Despite this it is wise to include them
in the format of the manifest as it is supposed to be interoperable, and developing a
highly specific mechanism for one particular platform and use case would go against what
SUIT is trying to achieve.

Finally are the elements presented by SUIT as optional such as directives, aliases,
best-before timestamp, component identifier, weighted URIs, and processing steps. These
elements should usually not be needed and preparing for their regular occurence in the
manifest would waste space. There is an argument to be made about having the best-before
timestamp as a regular element, but it is only relevant in contexts where firmware expires
which is not always the case. For rollbacks, sequence numbers (which themselves can be
timestamps) already solve that.These elements can be included as options, mapping option
codes to values, as presented in Table \ref{tab:option-codes}. By including these as
options, the manifest size can be reduced.

\begin{longtable}[]{@{}ll@{}}
    \caption{The manifest options.}
    \label{tab:option-codes}\\
    \toprule
    Option Number & Option Value\tabularnewline
    \midrule
    \endhead
    1 & directives\tabularnewline
    2 & processingSteps\tabularnewline
    3 & URIs\tabularnewline
    4 & aliases\tabularnewline
    5 & component\tabularnewline
    \bottomrule
\end{longtable}
    

Subsection \ref{ssec:mandatory-elements} explains the structure of the manifest. Optional
elements and their structure are explained in Subsection \ref{ssec:options}.

\subsection{Mandatory Elements}
\label{ssec:mandatory-elements}
% Show header format, motivate sizes

\subsection{Options}
\label{ssec:options}
% Show options format, motivate sizes

\end{document}