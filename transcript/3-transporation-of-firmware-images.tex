\documentclass[0-thesis.tex]{subfiles}

\begin{document}
% TODO: Dedicate this to transportation CoAP -> DTLS -> UDP
% TODO: Also format of manifest
% TODO: Encoding? CBOR?

\section{Manifest Format}
\label{sec:manifest-format}
% General intro to the chapter
% Maybe state assumptions about storage and computational capability of target devices?
As the target devices of the update mechanism are contrained IoT devices, the manifest
format must be designed with careful consideration. The format must be easy to parse in
order to reduce power consumption on devices, but must also be small so that
transportation of the manifest is done as quickly as possible. As a rule of thumb, each
byte sent expends as much energy as roughly 8000 CPU cycles, so reducing the size of the
manifest is of importance \parencite{interconnecting}.



In order to provide secure and valid updates, a manifest needs to reach the device. The
device then parses the manifest to see if the update is untampered with and applicable.
Not all elements of the manifest are relevant for all use cases, but as the thesis aims to
be as compliant with SUIT as possible, all mandatory elements will be added. The
non-mandatory elements that are regarded as necessary will also be added in the standard
manifest format, with room for optional elements. These may not be implemented in the
parser, but at least be considered for the manifest format. % TODO: Diskutera detta med
% n√•gon (Shahid?)

The manifest format will consist of several structured nested in the general ManifestInfo
structure. The structures, their elements, and their motivations will be explained in
Subsection \ref{ssec:mandatory-elements}. Optional elements and their structure will be
explained in Subsection \ref{ssec:options}.

\subsection{Mandatory Elements}
\label{ssec:mandatory-elements}
% Show header format, motivate sizes
At the top level resides the ManifestInfo structure. It is presented in Figure
\ref{fig:manifest-info}. The ManifestInfo structure contains the following fields:

\begin{itemize}
    \item versionID: The version number of the manifest format. 
    \item sequenceNumber: The sequence number of the image.
    \item dependencies: A URI/Digest structure containing digests of images needed before
            updating to this image, with URIs of where to find them.
    \item precursors: A URI/Digest structure containing precursor images for differential
            updates. 
    \item keyDistributionMethod: The key distributon method. In this thesis, EST-coaps
            will be used to enroll devices with assymetric keys.
    \item conditions: A Conditions structure containing different types of conditions
            (vendorID, classID, deviceID) and their respective UUIDs.
    \item best-before: A timestamp to avoid applying old images.
    \item aliases: A URI/Digest structure with alternative URIs for images.
    \item payloadInfo: A PayloadInfo structure containing information about the image.
    \item directives: A Directives structure containing instructions on how to process the
        entire manifest.
\end{itemize}
 
The other major structure is the PayloadInfo structure, shown in Figure
\ref{fig:payload-info}. It contains the following fields:

\begin{itemize}
    \item format: The format of the payload (ELF, binary, etc)
    \item storageLocation: Which component the payload is for. As the target hardware of
        the thesis only has one MCU, this is not of interest but mandatory for other kinds
        of devices
    \item digests: Digest(s) of the payload(s).
    \item XIP: Adresses for making sure the payloads are distributed to their correct
        components. Only relevant with several digests in the PayloadInfo structure.
    \item size: The size of the payload in bytes.
    \item URI: Where to get the payload.
    \item processingSteps: A Directives structure containing instructions on how to
        process the payload
\end{itemize}

The Conditions, URI/Digest, and Directives structures are small structures mapping Types
to UUIDs, Types to Values, and URIs to digests. These are broken out in individual
structures as they can contain a varying amount of entries each. 
\begin{figure}
    \caption{The ManifestInfo structure.}
    \label{fig:manifest-info}
\end{figure}

\subsection{Options}
\label{ssec:options}
% Show options format, motivate sizes

\end{document}